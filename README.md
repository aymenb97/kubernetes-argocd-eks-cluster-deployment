# argocd-eks-cluster-deployment
Terraform module to create an EKS Cluster

# Pre-requisites:
Ensure that you have installed the following tools:
1. aws cli
2. eksctl
3. kubectl 
 
# Usage: 

## 1. Deploy the  Amazon EKS cluster:

navigate to `example` then

```shell
$ terraform init
```

```shell
$ terraform plan
```
```shell
$ terraform apply
```
## 2. Create a `kubeconfig` for Amazon EKS:

To create a `kubeconfig` file with the AWS CLI:

```shell
aws eks update-kubeconfig --region region-code --name cluster-name
```
Test your configuration:

```shell
kubectl get svc
```
Retrieve the endpoint for your cluster:

```shell
aws eks describe-cluster --region region-code --name cluster-name --query "cluster.endpoint" --output text
```

## 3. Argo CD:

1. Install Argo CD:

```shell
kubectl create namespace argocd
```

```shell
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/v2.0.4/manifests/install.yaml
```

2. Install Argo CD CLI to interact with the API Server:

```shell
sudo curl --silent --location -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/download/v2.0.4/argocd-linux-amd64
```

```shell
sudo chmod +x /usr/local/bin/argocd
```
3. Expose Argo CD Server:

```shell
kubectl patch svc argocd-server -n argocd -p '{"spec": {"type": "LoadBalancer"}}'
```
4. Login:

the password is autogenerated with the pod name of the ArgoCD API Server:

```shell
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d
```

using the `admin` as the login and the auto generated password:

```shell
argocd login server --username admin --password autogenerated_password --insecure
```
you get as output:

```shell
'admin' logged in successfully 
```

